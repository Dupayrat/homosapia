<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <!-- Google Analytics 4 — remplacer G-XXXXXXXXXX par votre Measurement ID -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-XXXXXXXXXX');</script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diagnostic IA - Homo SapIA</title>
  <meta name="description" content="Évaluez la maturité IA de votre entreprise en 5 minutes. Diagnostic gratuit avec résultats immédiats et plan d'action personnalisé.">
  <meta property="og:title" content="Diagnostic IA en 5 minutes - Homo SapIA">
  <meta property="og:description" content="Évaluez la maturité IA de votre entreprise et recevez un plan d'action personnalisé.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://homosapia.com/diagnostic.html">
  <meta property="og:image" content="https://homosapia.com/og-image.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:locale" content="fr_FR">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Diagnostic IA en 5 minutes - Homo SapIA">
  <meta name="twitter:description" content="Évaluez la maturité IA de votre entreprise et recevez un plan d'action personnalisé.">
  <meta name="twitter:image" content="https://homosapia.com/og-image.jpg">
  <link rel="canonical" href="https://homosapia.com/diagnostic.html">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0A0A0F;
      --bg-elevated: #12121A;
      --bg-card: #16161F;
      --text: #E8E6E1;
      --text-muted: #8A8A95;
      --accent: #F26B3A;
      --accent-glow: rgba(242, 107, 58, 0.15);
      --accent-hover: #FF8855;
      --sapiens: #3A8FF2;
      --sapiens-glow: rgba(58, 143, 242, 0.12);
      --border: rgba(255,255,255,0.06);
      --serif: 'Instrument Serif', Georgia, serif;
      --sans: 'DM Sans', system-ui, sans-serif;
      --radius: 16px;
      --max-w: 800px;
    }

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }

    body {
      font-family: var(--sans);
      background: var(--bg);
      color: var(--text);
      line-height: 1.65;
      font-size: 16px;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 9999;
    }

    /* ---- NAV ---- */
    nav {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 1000;
      padding: 16px 0;
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      background: rgba(10, 10, 15, 0.8);
      border-bottom: 1px solid var(--border);
    }
    .nav-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .logo {
      font-family: var(--serif);
      font-size: 1.5rem;
      color: var(--text);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 2px;
    }
    .logo-ia { color: var(--accent); font-style: italic; }
    .nav-back {
      color: var(--text-muted);
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 500;
      transition: color 0.2s;
    }
    .nav-back:hover { color: var(--text); }

    /* ---- PROGRESS BAR (inline, under question header) ---- */
    .progress-inline {
      max-width: 420px;
      margin: 0 auto 28px;
      display: none;
    }
    .progress-inline.visible { display: block; }
    .progress-inline-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .progress-inline-label {
      font-size: 0.78rem;
      color: var(--text-muted);
      font-weight: 500;
      letter-spacing: 0.3px;
    }
    .progress-inline-pct {
      font-size: 0.82rem;
      font-weight: 700;
      color: var(--accent);
      font-variant-numeric: tabular-nums;
    }
    .progress-inline-track {
      height: 8px;
      background: rgba(255,255,255,0.06);
      border-radius: 100px;
      overflow: hidden;
      position: relative;
    }
    .progress-inline-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--sapiens));
      border-radius: 100px;
      transition: width 0.5s cubic-bezier(.22,1,.36,1);
      width: 0%;
      position: relative;
    }
    .progress-inline-fill::after {
      content: '';
      position: absolute;
      right: 0; top: 0; bottom: 0;
      width: 24px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3));
      border-radius: 0 100px 100px 0;
    }
    .progress-inline-dots {
      display: flex;
      justify-content: space-between;
      margin-top: 6px;
      padding: 0 1px;
    }
    .progress-inline-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: rgba(255,255,255,0.08);
      transition: background 0.3s, transform 0.3s;
    }
    .progress-inline-dot.done { background: var(--accent); transform: scale(1.1); }
    .progress-inline-dot.active { background: var(--sapiens); transform: scale(1.3); box-shadow: 0 0 8px rgba(58,143,242,0.5); }

    /* ---- CONTAINER ---- */
    .container {
      max-width: var(--max-w);
      margin: 0 auto;
      padding: 0 24px;
    }

    /* ---- SECTIONS ---- */
    .section {
      display: none;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease, transform 0.5s ease;
      padding-top: 100px;
      min-height: 100vh;
    }
    .section.active {
      display: block;
    }
    .section.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .section-results {
      min-height: auto;
      padding-bottom: 80px;
    }

    /* ---- LANDING ---- */
    .landing {
      text-align: center;
      padding-top: 140px;
      position: relative;
    }
    .landing::before {
      content: '';
      position: absolute;
      top: -100px; right: -200px;
      width: 600px; height: 600px;
      background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%);
      pointer-events: none;
    }
    .landing::after {
      content: '';
      position: absolute;
      bottom: -100px; left: -200px;
      width: 500px; height: 500px;
      background: radial-gradient(circle, var(--sapiens-glow) 0%, transparent 70%);
      pointer-events: none;
    }
    .landing-content {
      position: relative;
      z-index: 1;
    }
    .landing-label {
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 20px;
    }
    .landing h1 {
      font-family: var(--serif);
      font-size: clamp(2.4rem, 6vw, 3.6rem);
      line-height: 1.1;
      margin-bottom: 20px;
    }
    .landing h1 .highlight {
      color: var(--accent);
      font-style: italic;
    }
    .landing .subtitle {
      color: var(--text-muted);
      font-size: 1.1rem;
      max-width: 540px;
      margin: 0 auto 36px;
      line-height: 1.7;
    }

    /* ---- BUTTONS ---- */
    .btn-primary {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 16px 36px;
      border-radius: 100px;
      font-family: var(--sans);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 24px rgba(242, 107, 58, 0.25);
    }
    .btn-primary:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 32px rgba(242, 107, 58, 0.35);
    }
    .btn-secondary {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: transparent;
      color: var(--text);
      border: 1px solid var(--border);
      padding: 14px 32px;
      border-radius: 100px;
      font-family: var(--sans);
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-secondary:hover {
      border-color: rgba(255,255,255,0.15);
      background: var(--bg-elevated);
    }
    .btn-sapiens {
      background: var(--sapiens);
      box-shadow: 0 4px 24px rgba(58, 143, 242, 0.25);
    }
    .btn-sapiens:hover {
      background: #4D9BF5;
      box-shadow: 0 6px 32px rgba(58, 143, 242, 0.35);
    }

    /* ---- BADGES ---- */
    .badges {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-top: 32px;
      flex-wrap: wrap;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: 100px;
      padding: 8px 18px;
      font-size: 0.85rem;
      color: var(--text-muted);
    }
    .badge .check { color: var(--accent); }

    /* ---- VALUE CARDS ---- */
    .value-cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-top: 48px;
    }
    .value-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 28px 20px;
      text-align: center;
    }
    .value-card-icon {
      width: 48px; height: 48px;
      margin: 0 auto 16px;
      background: var(--bg-elevated);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
    }
    .value-card h3 {
      font-family: var(--serif);
      font-size: 1.15rem;
      margin-bottom: 8px;
    }
    .value-card p {
      color: var(--text-muted);
      font-size: 0.85rem;
      line-height: 1.6;
    }

    /* ---- FORM SECTION (step0) ---- */
    .form-section {
      padding-top: 120px;
    }
    .form-section h2 {
      font-family: var(--serif);
      font-size: clamp(1.6rem, 4vw, 2.2rem);
      margin-bottom: 8px;
      text-align: center;
    }
    .form-section .form-subtitle {
      color: var(--text-muted);
      text-align: center;
      margin-bottom: 36px;
      font-size: 0.95rem;
    }
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      max-width: 600px;
      margin: 0 auto;
    }
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .form-group.full-width {
      grid-column: 1 / -1;
    }
    .form-group label {
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-muted);
    }
    .form-group input,
    .form-group select {
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px 16px;
      font-family: var(--sans);
      font-size: 0.95rem;
      color: var(--text);
      outline: none;
      transition: border-color 0.2s;
      width: 100%;
      appearance: none;
      -webkit-appearance: none;
    }
    .form-group select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' fill='none' stroke='%238A8A95' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 16px center;
      padding-right: 40px;
      cursor: pointer;
    }
    .form-group input:focus,
    .form-group select:focus {
      border-color: var(--accent);
    }
    .form-group input::placeholder {
      color: var(--text-muted);
      opacity: 0.6;
    }
    .form-group select option {
      background: var(--bg-card);
      color: var(--text);
    }
    .form-actions {
      text-align: center;
      margin-top: 36px;
    }

    /* ---- QUESTION SECTION ---- */
    .question-section {
      padding-top: 120px;
      min-height: calc(100vh - 68px);
      display: flex;
      flex-direction: column;
    }
    .question-header {
      text-align: center;
      margin-bottom: 12px;
    }
    .question-step {
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 6px;
    }
    .question-pillar {
      font-size: 0.85rem;
      color: var(--sapiens);
      margin-bottom: 24px;
      font-weight: 500;
    }
    .question-text {
      font-family: var(--serif);
      font-size: clamp(1.4rem, 3.5vw, 1.9rem);
      line-height: 1.3;
      text-align: center;
      margin-bottom: 40px;
      max-width: 650px;
      margin-left: auto;
      margin-right: auto;
    }

    /* ---- ANSWER CARDS ---- */
    .answer-cards {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-width: 620px;
      margin: 0 auto;
      flex-grow: 1;
    }
    .answer-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px 24px;
      cursor: pointer;
      transition: all 0.25s ease;
      display: flex;
      align-items: flex-start;
      gap: 16px;
      user-select: none;
    }
    .answer-card:hover {
      border-color: rgba(255,255,255,0.12);
      background: var(--bg-elevated);
      transform: translateX(4px);
    }
    .answer-card.selected {
      border-color: var(--accent);
      background: rgba(242, 107, 58, 0.06);
      box-shadow: 0 0 0 1px var(--accent);
    }
    .answer-card.flash {
      border-color: var(--accent);
      background: rgba(242, 107, 58, 0.1);
    }
    .answer-indicator {
      width: 28px; height: 28px;
      min-width: 28px;
      border-radius: 50%;
      border: 2px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-muted);
      transition: all 0.25s;
      margin-top: 2px;
    }
    .answer-card.selected .answer-indicator {
      border-color: var(--accent);
      background: var(--accent);
      color: #fff;
    }
    .answer-label {
      font-size: 0.95rem;
      line-height: 1.5;
    }
    .answer-label strong {
      color: var(--text);
      font-weight: 600;
    }
    .answer-label span {
      color: var(--text-muted);
    }

    /* ---- QUESTION NAVIGATION ---- */
    .question-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 620px;
      margin: 32px auto 0;
      padding-bottom: 40px;
    }
    .btn-back {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: none;
      border: none;
      color: var(--text-muted);
      font-family: var(--sans);
      font-size: 0.9rem;
      cursor: pointer;
      padding: 10px 0;
      transition: color 0.2s;
    }
    .btn-back:hover { color: var(--text); }
    .btn-next {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 14px 28px;
      border-radius: 100px;
      font-family: var(--sans);
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      opacity: 0.4;
      pointer-events: none;
    }
    .btn-next.enabled {
      opacity: 1;
      pointer-events: auto;
    }
    .btn-next.enabled:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }

    /* ---- RESULTS ---- */
    .results-header {
      text-align: center;
      margin-bottom: 48px;
    }
    .results-header h2 {
      font-family: var(--serif);
      font-size: clamp(1.8rem, 4vw, 2.6rem);
      margin-bottom: 8px;
    }
    .results-header p {
      color: var(--text-muted);
      font-size: 1rem;
    }

    /* Score circle */
    .score-circle-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 48px;
    }
    .score-circle {
      position: relative;
      width: 200px; height: 200px;
    }
    .score-circle svg {
      width: 200px; height: 200px;
      transform: rotate(-90deg);
    }
    .score-circle-bg {
      fill: none;
      stroke: var(--bg-elevated);
      stroke-width: 8;
    }
    .score-circle-fill {
      fill: none;
      stroke-width: 8;
      stroke-linecap: round;
      transition: stroke-dashoffset 1.5s ease;
    }
    .score-circle-text {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .score-number {
      font-family: var(--serif);
      font-size: 3rem;
      font-weight: 400;
      line-height: 1;
    }
    .score-total {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 2px;
    }
    .score-level {
      margin-top: 16px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 20px;
      border-radius: 100px;
      font-size: 0.9rem;
      font-weight: 600;
    }
    .score-level-desc {
      color: var(--text-muted);
      margin-top: 12px;
      font-size: 0.95rem;
      text-align: center;
      max-width: 480px;
    }

    /* Radar chart */
    .radar-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 48px;
    }
    .radar-title {
      font-family: var(--serif);
      font-size: 1.4rem;
      margin-bottom: 24px;
      text-align: center;
    }
    .radar-svg {
      width: 100%; max-width: 400px; height: auto;
      overflow: visible;
    }
    .radar-labels {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px 20px;
      margin-top: 16px;
    }
    .radar-label-item {
      font-size: 0.8rem;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .radar-label-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: var(--accent);
    }

    /* Pillar bars */
    .pillar-bars {
      margin-bottom: 48px;
    }
    .pillar-bars-title {
      font-family: var(--serif);
      font-size: 1.4rem;
      margin-bottom: 24px;
      text-align: center;
    }
    .pillar-bar-item {
      margin-bottom: 20px;
    }
    .pillar-bar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .pillar-bar-name {
      font-size: 0.9rem;
      font-weight: 500;
    }
    .pillar-bar-score {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-muted);
    }
    .pillar-bar-track {
      height: 10px;
      background: var(--bg-elevated);
      border-radius: 5px;
      overflow: hidden;
    }
    .pillar-bar-fill {
      height: 100%;
      border-radius: 5px;
      transition: width 1.2s ease;
      width: 0%;
    }

    /* Recommendations */
    .reco-section {
      margin-bottom: 48px;
    }
    .reco-title {
      font-family: var(--serif);
      font-size: 1.4rem;
      margin-bottom: 24px;
      text-align: center;
    }
    .reco-cards {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .reco-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 28px;
      position: relative;
      overflow: hidden;
    }
    .reco-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0;
      width: 4px; height: 100%;
    }
    .reco-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
      flex-wrap: wrap;
      gap: 8px;
    }
    .reco-card-pillar {
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 1.5px;
      text-transform: uppercase;
    }
    .reco-card-score {
      font-size: 0.8rem;
      padding: 4px 12px;
      border-radius: 100px;
      font-weight: 600;
    }
    .reco-card-insight {
      font-size: 0.95rem;
      line-height: 1.6;
      margin-bottom: 16px;
    }
    .reco-card-action {
      background: var(--bg-elevated);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }
    .reco-card-action-label {
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 6px;
    }
    .reco-card-action-text {
      font-size: 0.9rem;
      color: var(--text);
      line-height: 1.6;
    }
    .reco-card-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--sapiens);
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 500;
      transition: color 0.2s;
    }
    .reco-card-link:hover { color: #5DA5F5; }

    /* Lead capture */
    /* ---- GATE (lead capture before results) ---- */
    .gate-section {
      max-width: 560px;
      margin: 0 auto;
      text-align: center;
    }
    .gate-section h2 {
      font-family: var(--serif);
      font-size: 2rem;
      margin-bottom: 8px;
    }
    .gate-section h2 .highlight { color: var(--accent); }
    .gate-subtitle {
      color: var(--text-muted);
      font-size: 1rem;
      margin-bottom: 32px;
      line-height: 1.6;
    }
    .gate-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      text-align: left;
    }
    .gate-form .full-width { grid-column: 1 / -1; }
    .gate-form label {
      display: block;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 6px;
    }
    .gate-form input {
      width: 100%;
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px 18px;
      font-family: var(--sans);
      font-size: 0.95rem;
      color: var(--text);
      outline: none;
      transition: border-color 0.3s;
    }
    .gate-form input:focus { border-color: var(--accent); }
    .gate-form input::placeholder { color: var(--text-muted); opacity: 0.5; }
    .gate-actions {
      grid-column: 1 / -1;
      text-align: center;
      margin-top: 8px;
    }
    .gate-trust {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 24px;
      margin-top: 20px;
      grid-column: 1 / -1;
    }
    .gate-trust span {
      font-size: 0.8rem;
      color: var(--text-muted);
      opacity: 0.7;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .gate-trust .gt-icon { color: var(--accent); font-size: 0.9rem; }
    .gate-loading {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      margin-top: 24px;
      grid-column: 1 / -1;
    }
    .gate-spinner {
      width: 40px; height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .gate-loading p { color: var(--text-muted); font-size: 0.9rem; }

    /* old lead capture (now in results) */
    .lead-capture {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 40px;
      text-align: center;
      margin-bottom: 32px;
    }
    .lead-capture h3 {
      font-family: var(--serif);
      font-size: 1.4rem;
      margin-bottom: 8px;
    }
    .lead-capture .lead-desc {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-bottom: 24px;
    }
    .lead-form {
      display: flex;
      gap: 12px;
      max-width: 480px;
      margin: 0 auto;
    }
    .lead-form input {
      flex: 1;
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: 100px;
      padding: 14px 20px;
      font-family: var(--sans);
      font-size: 0.95rem;
      color: var(--text);
      outline: none;
      transition: border-color 0.2s;
    }
    .lead-form input:focus {
      border-color: var(--accent);
    }
    .lead-form input::placeholder {
      color: var(--text-muted);
      opacity: 0.6;
    }
    .lead-form button {
      white-space: nowrap;
    }
    .lead-small {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 12px;
      opacity: 0.7;
    }
    .lead-success {
      display: none;
      color: #4CAF50;
      font-weight: 500;
      margin-top: 12px;
    }

    /* CTA final */
    .cta-final {
      text-align: center;
      margin-bottom: 48px;
      padding: 48px 24px;
      background: linear-gradient(135deg, rgba(242, 107, 58, 0.08) 0%, rgba(58, 143, 242, 0.08) 100%);
      border: 1px solid var(--border);
      border-radius: var(--radius);
    }
    .cta-final h3 {
      font-family: var(--serif);
      font-size: 1.6rem;
      margin-bottom: 12px;
    }
    .cta-final p {
      color: var(--text-muted);
      margin-bottom: 24px;
      font-size: 0.95rem;
    }
    .cta-final a {
      text-decoration: none;
    }

    /* Restart button */
    .restart-wrap {
      text-align: center;
      margin-top: 32px;
      margin-bottom: 48px;
    }
    .btn-restart {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
      padding: 12px 28px;
      border-radius: var(--radius);
      font-family: var(--sans);
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-restart:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    /* ---- RESUME MODAL ---- */
    .resume-overlay {
      position: fixed;
      inset: 0;
      background: rgba(10, 10, 15, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .resume-modal {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 40px;
      max-width: 440px;
      width: 100%;
      text-align: center;
      animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }
    @keyframes slideUp { from { opacity: 0; transform: translateY(24px); } to { opacity: 1; transform: translateY(0); } }
    .resume-modal h3 {
      font-family: var(--serif);
      font-size: 1.4rem;
      margin-bottom: 8px;
    }
    .resume-modal p {
      color: var(--text-muted);
      font-size: 0.9rem;
      line-height: 1.6;
      margin-bottom: 24px;
    }
    .resume-progress-info {
      display: inline-block;
      background: rgba(242, 107, 58, 0.1);
      border: 1px solid rgba(242, 107, 58, 0.2);
      border-radius: 100px;
      padding: 6px 16px;
      font-size: 0.82rem;
      font-weight: 500;
      color: var(--accent);
      margin-bottom: 24px;
    }
    .resume-actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .resume-actions .btn-primary {
      width: 100%;
      justify-content: center;
    }
    .btn-ghost {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
      padding: 14px 28px;
      border-radius: var(--radius);
      font-family: var(--sans);
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-ghost:hover {
      border-color: rgba(255,255,255,0.15);
      color: var(--text);
    }

    /* ---- RESPONSIVE ---- */
    @media (max-width: 640px) {
      .value-cards {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      .form-grid {
        grid-template-columns: 1fr;
      }
      .badges {
        gap: 8px;
      }
      .badge {
        font-size: 0.78rem;
        padding: 6px 14px;
      }
      .answer-card {
        padding: 16px 18px;
      }
      .gate-form {
        grid-template-columns: 1fr;
      }
      .gate-trust {
        flex-direction: column;
        gap: 8px;
      }
      .lead-form {
        flex-direction: column;
      }
      .lead-form button {
        width: 100%;
        justify-content: center;
      }
      .radar-svg {
        width: 280px; height: 280px;
      }
      .reco-card {
        padding: 20px;
      }
      .lead-capture {
        padding: 28px 20px;
      }
      .cta-final {
        padding: 32px 20px;
      }
    }

    /* ---- ANIMATIONS ---- */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(24px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-in {
      animation: fadeInUp 0.5s ease forwards;
    }
    .animate-delay-1 { animation-delay: 0.1s; opacity: 0; }
    .animate-delay-2 { animation-delay: 0.2s; opacity: 0; }
    .animate-delay-3 { animation-delay: 0.3s; opacity: 0; }
    .animate-delay-4 { animation-delay: 0.4s; opacity: 0; }
  </style>

  <!-- ═══ SCHEMA.ORG ═══ -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Diagnostic IA - Homo SapIA",
    "url": "https://homosapia.com/diagnostic.html",
    "description": "Évaluez la maturité IA de votre entreprise en 5 minutes. Diagnostic gratuit avec résultats immédiats et plan d'action personnalisé.",
    "applicationCategory": "BusinessApplication",
    "operatingSystem": "Web",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "EUR",
      "description": "Diagnostic IA gratuit"
    },
    "provider": {
      "@type": "Organization",
      "name": "Homo SapIA",
      "url": "https://homosapia.com"
    }
  }
  </script>
</head>
<body>

  <!-- NAV -->
  <nav>
    <div class="nav-inner">
      <a href="https://homosapia.com" class="logo">Homo Sap<span class="logo-ia">IA</span></a>
      <a href="https://homosapia.com" class="nav-back" data-i18n="nav.back">&larr; Retour au site</a>
    </div>
  </nav>
  <div style="position:fixed;top:60px;right:24px;z-index:999;">
    <button id="langToggle" onclick="toggleLang()" style="background:rgba(10,10,15,0.85);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,0.1);border-radius:100px;padding:5px 12px;font-size:11px;font-family:var(--sans);font-weight:600;color:var(--text-muted);cursor:pointer;transition:all 0.2s;line-height:1;white-space:nowrap;" aria-label="Switch language"><strong>FR</strong> · <span style="opacity:0.4">EN</span> · <span style="opacity:0.4">ES</span></button>
  </div>

  <!-- I18N Engine -->
  <script>
  (function(){
    var i18nDiag = {
      en: {
        'nav.back': '\u2190 Back to site',
        'landing.label': 'Free diagnostic',
        'landing.title': 'AI <span class="highlight">Diagnostic</span> in 5 minutes',
        'landing.subtitle': 'Assess your company\'s AI maturity and receive a personalized action plan',
        'landing.btn': 'Start the diagnostic ',
        'landing.badge1': '100% free',
        'landing.badge2': '5 minutes',
        'landing.badge3': 'Instant results',
        'landing.card1.title': 'Precise diagnostic',
        'landing.card1.desc': '15 questions covering 5 key AI maturity pillars',
        'landing.card2.title': 'Actionable recommendations',
        'landing.card2.desc': 'Concrete actions tailored to your maturity level',
        'landing.card3.title': 'Prioritized action plan',
        'landing.card3.desc': 'Identify the key levers to activate first for your business',
        'profile.title': 'A few details about your company',
        'profile.subtitle': 'This information helps us personalize your diagnostic',
        'profile.company': 'Company name',
        'profile.website': 'Website <span style="opacity:0.5;font-weight:400">(optional)</span>',
        'profile.role': 'Your role',
        'profile.sector': 'Industry',
        'profile.size': 'Company size',
        'profile.btn': 'Start the diagnostic ',
        'q.back': 'Back',
        'q.next': 'Next',
        'gate.label': 'Final step',
        'gate.title': 'Your results are <span class="highlight">ready</span>',
        'gate.subtitle': 'Enter your details to access your full diagnostic and receive your personalized diagnostic by email.',
        'gate.firstname': 'First name',
        'gate.lastname': 'Last name',
        'gate.email': 'Professional email',
        'gate.phone': 'Phone <span style="opacity:0.5;font-weight:400">(optional)</span>',
        'gate.btn': 'See my results ',
        'gate.trust1': 'Confidential data',
        'gate.trust2': 'No spam',
        'gate.trust3': 'Instant results',
        'gate.loading': 'Generating your personalized diagnostic...',
        'results.label': 'Your results',
        'results.title': 'Your AI Diagnostic',
        'results.radar': 'Overview by pillar',
        'results.detail': 'Detail by pillar',
        'results.reco': 'Top 3 recommendations',
        'results.sent': '&#9989; Diagnostic sent!',
        'results.sentDesc': 'You will receive your personalized diagnostic with a detailed action plan within a few minutes at <strong id="sentToEmail"></strong>',
        'results.cta.title': 'Let\'s discuss your results',
        'results.cta.desc': 'A 30-minute exchange to turn this diagnostic into a concrete action plan',
        'results.cta.btn': 'Book a meeting ',
        'results.restart': 'Retake the diagnostic',
        'resume.title': 'Diagnostic in progress',
        'resume.desc': 'You have a diagnostic in progress. Would you like to resume or start over?',
        'resume.continue': 'Resume →',
        'resume.restart': 'Start from scratch'
      },
      es: {
        'nav.back': '\u2190 Volver al sitio',
        'landing.label': 'Diagn\u00f3stico gratuito',
        'landing.title': 'Diagn\u00f3stico <span class="highlight">IA</span> en 5 minutos',
        'landing.subtitle': 'Eval\u00fae la madurez IA de su empresa y reciba un plan de acci\u00f3n personalizado',
        'landing.btn': 'Iniciar el diagn\u00f3stico ',
        'landing.badge1': '100% gratuito',
        'landing.badge2': '5 minutos',
        'landing.badge3': 'Resultados inmediatos',
        'landing.card1.title': 'Diagn\u00f3stico preciso',
        'landing.card1.desc': '15 preguntas sobre 5 pilares clave de madurez IA',
        'landing.card2.title': 'Recomendaciones accionables',
        'landing.card2.desc': 'Acciones concretas adaptadas a su nivel de madurez',
        'landing.card3.title': 'Plan de acci\u00f3n priorizado',
        'landing.card3.desc': 'Identifique las palancas a activar prioritariamente para su empresa',
        'profile.title': 'Informaci\u00f3n sobre su empresa',
        'profile.subtitle': 'Estos datos nos permiten personalizar su diagn\u00f3stico',
        'profile.company': 'Nombre de la empresa',
        'profile.website': 'Sitio web <span style="opacity:0.5;font-weight:400">(opcional)</span>',
        'profile.role': 'Su funci\u00f3n',
        'profile.sector': 'Sector de actividad',
        'profile.size': 'Tama\u00f1o de la empresa',
        'profile.btn': 'Comenzar el diagn\u00f3stico ',
        'q.back': 'Atr\u00e1s',
        'q.next': 'Siguiente',
        'gate.label': '\u00daltimo paso',
        'gate.title': 'Sus resultados est\u00e1n <span class="highlight">listos</span>',
        'gate.subtitle': 'Ingrese sus datos para acceder a su diagn\u00f3stico completo y recibir su diagn\u00f3stico personalizado por email.',
        'gate.firstname': 'Nombre',
        'gate.lastname': 'Apellido',
        'gate.email': 'Email profesional',
        'gate.phone': 'Tel\u00e9fono <span style="opacity:0.5;font-weight:400">(opcional)</span>',
        'gate.btn': 'Ver mis resultados ',
        'gate.trust1': 'Datos confidenciales',
        'gate.trust2': 'Sin spam',
        'gate.trust3': 'Resultados inmediatos',
        'gate.loading': 'Generando su diagn\u00f3stico personalizado...',
        'results.label': 'Sus resultados',
        'results.title': 'Su diagn\u00f3stico IA',
        'results.radar': 'Visi\u00f3n general por pilar',
        'results.detail': 'Detalle por pilar',
        'results.reco': 'Top 3 recomendaciones',
        'results.sent': '&#9989; \u00a1Diagn\u00f3stico enviado!',
        'results.sentDesc': 'Recibir\u00e1 su diagn\u00f3stico personalizado con un plan de acci\u00f3n detallado en unos minutos en <strong id="sentToEmail"></strong>',
        'results.cta.title': 'Hablemos de sus resultados',
        'results.cta.desc': 'Un intercambio de 30 minutos para transformar este diagn\u00f3stico en un plan de acci\u00f3n concreto',
        'results.cta.btn': 'Reservar una cita ',
        'results.restart': 'Rehacer el diagn\u00f3stico',
        'resume.title': 'Diagn\u00f3stico en curso',
        'resume.desc': 'Tiene un diagn\u00f3stico en curso. \u00bfDesea retomarlo o empezar de nuevo?',
        'resume.continue': 'Retomar \u2192',
        'resume.restart': 'Empezar de cero'
      }
    };

    var langCycle = ['fr', 'en', 'es'];
    var langLabels = { fr: 'FR', en: 'EN', es: 'ES' };
    var currentLang = localStorage.getItem('homosapia_lang') || 'fr';

    function applyLang(lang) {
      var els = document.querySelectorAll('[data-i18n]');
      if (!window._i18nDiagFrStored) {
        els.forEach(function(el) {
          var isHtml = el.getAttribute('data-i18n-html') === '1';
          el.setAttribute('data-i18n-fr', isHtml ? el.innerHTML : el.textContent);
        });
        window._i18nDiagFrStored = true;
      }
      if (lang === 'fr') {
        els.forEach(function(el) {
          var fr = el.getAttribute('data-i18n-fr');
          if (fr !== null) {
            var isHtml = el.getAttribute('data-i18n-html') === '1';
            if (isHtml) el.innerHTML = fr; else el.textContent = fr;
          }
        });
      } else {
        var dict = i18nDiag[lang];
        if (!dict) return;
        els.forEach(function(el) {
          var key = el.getAttribute('data-i18n');
          if (dict[key]) {
            var isHtml = el.getAttribute('data-i18n-html') === '1';
            if (isHtml) el.innerHTML = dict[key]; else el.textContent = dict[key];
          }
        });
      }
      currentLang = lang;
      if (typeof currentDiagLang !== 'undefined') window.currentDiagLang = lang;
      document.documentElement.lang = lang;
      var toggleBtn = document.getElementById('langToggle');
      if (toggleBtn) {
        toggleBtn.innerHTML = langCycle.map(function(l) {
          return l === lang ? '<strong>' + langLabels[l] + '</strong>' : '<span style="opacity:0.4">' + langLabels[l] + '</span>';
        }).join(' \u00b7 ');
      }
      localStorage.setItem('homosapia_lang', lang);

      // Update dynamic sections if they are active
      if (typeof renderQuestion === 'function' && document.getElementById('sectionQuestions') && document.getElementById('sectionQuestions').classList.contains('active')) {
        renderQuestion();
      }
      // Re-render results if visible
      if (typeof showResults === 'function' && document.getElementById('sectionResults') && document.getElementById('sectionResults').classList.contains('active')) {
        var pillarScores = [0, 0, 0, 0, 0];
        if (typeof QUESTIONS !== 'undefined' && typeof answers !== 'undefined') {
          QUESTIONS.forEach(function(q, i) {
            if (answers[i] !== null) pillarScores[q.pillar] += q.answers[answers[i]].score;
          });
          var totalScore = pillarScores.reduce(function(a, b) { return a + b; }, 0);
          // Convert to /100 scale (raw: 15 questions × 4 = 60 max)
          totalScore = Math.round(totalScore * 100 / 60);
          pillarScores = pillarScores.map(function(s) { return Math.round(s * 20 / 12); });
          if (typeof renderLevel === 'function') renderLevel(totalScore);
          if (typeof renderRadar === 'function') renderRadar(pillarScores);
          if (typeof renderPillarBars === 'function') renderPillarBars(pillarScores);
          if (typeof renderRecommendations === 'function') renderRecommendations(pillarScores);
        }
      }
    }

    window.toggleLang = function() {
      var idx = langCycle.indexOf(currentLang);
      var next = langCycle[(idx + 1) % langCycle.length];
      applyLang(next);
    };
    window.diagLang = function() { return currentLang; };

    document.addEventListener('DOMContentLoaded', function() {
      if (currentLang !== 'fr') applyLang(currentLang);
    });
  })();
  </script>

  <!-- PROGRESS BAR (old fixed — removed, now inline in question section) -->

  <!-- ==================== LANDING ==================== -->
  <div class="section active" id="sectionLanding">
    <div class="container landing">
      <div class="landing-content">
        <div class="landing-label" data-i18n="landing.label">Diagnostic gratuit</div>
        <h1 data-i18n="landing.title" data-i18n-html="1">Diagnostic <span class="highlight">IA</span> en 5 minutes</h1>
        <p class="subtitle" data-i18n="landing.subtitle">Évaluez la maturité IA de votre entreprise et recevez un plan d'action personnalisé</p>
        <button class="btn-primary" onclick="showStep0()">
          <span data-i18n="landing.btn">Lancer le diagnostic </span><span>&rarr;</span>
        </button>
        <div class="badges">
          <span class="badge"><span class="check">&#10003;</span> <span data-i18n="landing.badge1">100% gratuit</span></span>
          <span class="badge"><span class="check">&#10003;</span> <span data-i18n="landing.badge2">5 minutes</span></span>
          <span class="badge"><span class="check">&#10003;</span> <span data-i18n="landing.badge3">Résultats immédiats</span></span>
        </div>
        <div class="value-cards">
          <div class="value-card">
            <div class="value-card-icon">&#127919;</div>
            <h3 data-i18n="landing.card1.title">Diagnostic précis</h3>
            <p data-i18n="landing.card1.desc">15 questions couvrant 5 piliers clés de la maturité IA</p>
          </div>
          <div class="value-card">
            <div class="value-card-icon">&#9889;</div>
            <h3 data-i18n="landing.card2.title">Recommandations actionnables</h3>
            <p data-i18n="landing.card2.desc">Des actions concrètes adaptées à votre niveau de maturité</p>
          </div>
          <div class="value-card">
            <div class="value-card-icon">&#128203;</div>
            <h3 data-i18n="landing.card3.title">Plan d'action priorisé</h3>
            <p data-i18n="landing.card3.desc">Identifiez les leviers à activer en priorité pour votre entreprise</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== STEP 0 - COMPANY PROFILE ==================== -->
  <div class="section" id="sectionProfile">
    <div class="container form-section">
      <h2 data-i18n="profile.title">Quelques informations sur votre entreprise</h2>
      <p class="form-subtitle" data-i18n="profile.subtitle">Ces données nous permettent de personnaliser votre diagnostic</p>
      <div class="form-grid">
        <div class="form-group full-width">
          <label for="companyName" data-i18n="profile.company">Nom de l'entreprise</label>
          <input type="text" id="companyName" placeholder="ex: Acme Corp">
        </div>
        <div class="form-group full-width">
          <label for="companyWebsite" data-i18n="profile.website" data-i18n-html="1">Site web <span style="opacity:0.5;font-weight:400">(optionnel)</span></label>
          <input type="url" id="companyWebsite" placeholder="ex: https://acme.com">
        </div>
        <div class="form-group">
          <label for="role" data-i18n="profile.role">Votre fonction</label>
          <select id="role">
            <option value="" disabled selected>Sélectionnez</option>
            <option value="Dirigeant/CEO">Dirigeant / CEO</option>
            <option value="COO/Directeur Opérations">COO / Directeur des Opérations</option>
            <option value="DAF/Directeur Financier">DAF / Directeur Financier</option>
            <option value="DRH/RH">DRH / RH</option>
            <option value="DSI/CTO">DSI / CTO</option>
            <option value="Directeur Commercial/Marketing">Directeur Commercial / Marketing</option>
            <option value="Responsable Innovation/Digital">Responsable Innovation / Digital</option>
            <option value="Manager">Manager</option>
            <option value="Chef de projet/PMO">Chef de projet / PMO</option>
            <option value="Autre">Autre</option>
          </select>
        </div>
        <div class="form-group">
          <label for="sector" data-i18n="profile.sector">Secteur d'activité</label>
          <select id="sector">
            <option value="" disabled selected>Sélectionnez</option>
            <option value="Services B2B">Services B2B</option>
            <option value="Conseil/ESN">Conseil / ESN</option>
            <option value="Tech/SaaS">Tech / SaaS</option>
            <option value="Industrie">Industrie</option>
            <option value="Commerce/Retail">Commerce / Retail</option>
            <option value="Finance/Assurance">Finance / Assurance</option>
            <option value="Santé">Santé</option>
            <option value="Éducation/Formation">Éducation / Formation</option>
            <option value="Transport/Logistique">Transport / Logistique</option>
            <option value="Énergie/Environnement">Énergie / Environnement</option>
            <option value="Média/Communication">Média / Communication</option>
            <option value="Secteur public">Secteur public / Collectivités</option>
            <option value="BTP">BTP</option>
            <option value="Autre">Autre</option>
          </select>
        </div>
        <div class="form-group full-width">
          <label for="size" data-i18n="profile.size">Taille de l'entreprise</label>
          <select id="size">
            <option value="" disabled selected>Sélectionnez</option>
            <option value="1-20">1 - 20 collaborateurs</option>
            <option value="21-50">21 - 50 collaborateurs</option>
            <option value="51-200">51 - 200 collaborateurs</option>
            <option value="201-1000">201 - 1 000 collaborateurs</option>
            <option value="1000+">1 000+ collaborateurs</option>
          </select>
        </div>
      </div>
      <div class="form-actions">
        <button class="btn-primary" onclick="startDiagnostic()" id="btnStartDiag">
          <span data-i18n="profile.btn">Commencer le diagnostic </span><span>&rarr;</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ==================== QUESTIONS ==================== -->
  <div class="section" id="sectionQuestions">
    <div class="container question-section">
      <div class="question-header">
        <div class="question-step" id="qStep"></div>
        <div class="question-pillar" id="qPillar"></div>
      </div>
      <div class="progress-inline" id="progressInline">
        <div class="progress-inline-top">
          <span class="progress-inline-label" id="progressLabel"></span>
          <span class="progress-inline-pct" id="progressPct"></span>
        </div>
        <div class="progress-inline-track">
          <div class="progress-inline-fill" id="progressFill"></div>
        </div>
        <div class="progress-inline-dots" id="progressDots"></div>
      </div>
      <div class="question-text" id="qText"></div>
      <div class="answer-cards" id="answerCards"></div>
      <div class="question-nav">
        <button class="btn-back" onclick="prevQuestion()" id="btnPrev">
          <span>&larr;</span> <span data-i18n="q.back">Retour</span>
        </button>
        <button class="btn-next" id="btnNext" onclick="nextQuestion()">
          <span data-i18n="q.next">Suivant</span> <span>&rarr;</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ==================== GATE (lead capture) ==================== -->
  <div class="section" id="sectionGate">
    <div class="container form-section gate-section">
      <div class="landing-label" data-i18n="gate.label">Dernière étape</div>
      <h2 data-i18n="gate.title" data-i18n-html="1">Vos résultats sont <span class="highlight">prêts</span></h2>
      <p class="gate-subtitle" data-i18n="gate.subtitle">Renseignez vos coordonnées pour accéder à votre diagnostic complet et recevoir votre diagnostic personnalisé par email.</p>
      <div class="gate-form" id="gateForm">
        <div>
          <label for="gateFirstname" data-i18n="gate.firstname">Prénom</label>
          <input type="text" id="gateFirstname" placeholder="ex: Philippe">
        </div>
        <div>
          <label for="gateLastname" data-i18n="gate.lastname">Nom</label>
          <input type="text" id="gateLastname" placeholder="ex: du Payrat">
        </div>
        <div class="full-width">
          <label for="gateEmail" data-i18n="gate.email">Email professionnel</label>
          <input type="email" id="gateEmail" placeholder="vous@entreprise.com">
        </div>
        <div class="full-width">
          <label for="gatePhone" data-i18n="gate.phone" data-i18n-html="1">Téléphone <span style="opacity:0.5;font-weight:400">(optionnel)</span></label>
          <input type="tel" id="gatePhone" placeholder="06 00 00 00 00">
        </div>
        <div class="gate-actions">
          <button class="btn-primary" onclick="submitGate()">
            <span data-i18n="gate.btn">Voir mes résultats </span><span>&rarr;</span>
          </button>
        </div>
        <div class="gate-trust">
          <span><span class="gt-icon">&#128274;</span> <span data-i18n="gate.trust1">Données confidentielles</span></span>
          <span><span class="gt-icon">&#10003;</span> <span data-i18n="gate.trust2">Pas de spam</span></span>
          <span><span class="gt-icon">&#9889;</span> <span data-i18n="gate.trust3">Résultats immédiats</span></span>
        </div>
        <div class="gate-loading" id="gateLoading">
          <div class="gate-spinner"></div>
          <p data-i18n="gate.loading">Génération de votre diagnostic personnalisé...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== RESULTS ==================== -->
  <div class="section section-results" id="sectionResults">
    <div class="container" style="padding-top: 120px; padding-bottom: 60px;">
      <div class="results-header">
        <div class="landing-label" data-i18n="results.label">Vos résultats</div>
        <h2 data-i18n="results.title">Votre diagnostic IA</h2>
        <p id="resultsCompany"></p>
      </div>

      <!-- Score circle -->
      <div class="score-circle-wrap">
        <div class="score-circle">
          <svg viewBox="0 0 200 200">
            <circle class="score-circle-bg" cx="100" cy="100" r="88"/>
            <circle class="score-circle-fill" id="scoreCircleFill" cx="100" cy="100" r="88"
              stroke-dasharray="553" stroke-dashoffset="553"/>
          </svg>
          <div class="score-circle-text">
            <span class="score-number" id="scoreNumber">0</span>
            <span class="score-total">/ 100</span>
          </div>
        </div>
        <div class="score-level" id="scoreLevel"></div>
        <p class="score-level-desc" id="scoreLevelDesc"></p>
      </div>

      <!-- Radar chart -->
      <div class="radar-wrap">
        <h3 class="radar-title" data-i18n="results.radar">Vue d'ensemble par pilier</h3>
        <svg class="radar-svg" id="radarChart" viewBox="-40 -40 400 400"></svg>
        <div class="radar-labels" id="radarLabels"></div>
      </div>

      <!-- Pillar bars -->
      <div class="pillar-bars">
        <h3 class="pillar-bars-title" data-i18n="results.detail">Détail par pilier</h3>
        <div id="pillarBarsContainer"></div>
      </div>

      <!-- Recommendations -->
      <div class="reco-section">
        <h3 class="reco-title" data-i18n="results.reco">Top 3 recommandations</h3>
        <div class="reco-cards" id="recoCards"></div>
      </div>

      <!-- Rapport envoyé confirmation -->
      <div class="lead-capture" id="reportSent" style="display:none;">
        <h3 data-i18n="results.sent" data-i18n-html="1">&#9989; Diagnostic envoyé !</h3>
        <p class="lead-desc" data-i18n="results.sentDesc" data-i18n-html="1">Vous recevrez sous quelques minutes votre diagnostic personnalisé avec un plan d'action détaillé à <strong id="sentToEmail"></strong></p>
      </div>

      <!-- CTA final -->
      <div class="cta-final">
        <h3 data-i18n="results.cta.title">Discutons de vos résultats</h3>
        <p data-i18n="results.cta.desc">Un échange de 30 minutes pour transformer ce diagnostic en plan d'action concret</p>
        <a href="https://meetings-eu1.hubspot.com/pdu-payrat?uuid=5a24cb40-61aa-41f5-aee3-8cc6a8cae0bf" target="_blank" rel="noopener">
          <button class="btn-primary btn-sapiens">
            <span data-i18n="results.cta.btn">Prendre rendez-vous </span><span>&rarr;</span>
          </button>
        </a>
      </div>

      <!-- Restart diagnostic -->
      <div class="restart-wrap">
        <button class="btn-restart" onclick="restartDiagnostic()">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="margin-right:6px;vertical-align:middle;">
            <path d="M2 8a6 6 0 0 1 10.3-4.2L11 5h4V1l-1.6 1.6A7.97 7.97 0 0 0 0 8h2zm12 0a6 6 0 0 1-10.3 4.2L5 11H1v4l1.6-1.6A7.97 7.97 0 0 0 16 8h-2z" fill="currentColor"/>
          </svg>
          <span data-i18n="results.restart">Refaire le diagnostic</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ==================== RESUME MODAL ==================== -->
  <div class="resume-overlay" id="resumeModal" style="display:none;">
    <div class="resume-modal">
      <h3 data-i18n="resume.title">Diagnostic en cours</h3>
      <p data-i18n="resume.desc">Vous avez un diagnostic en cours. Souhaitez-vous le reprendre ou recommencer ?</p>
      <div class="resume-progress-info" id="resumeProgress"></div>
      <div class="resume-actions">
        <button class="btn-primary" onclick="resumeDiagnostic()">
          <span data-i18n="resume.continue">Reprendre →</span>
        </button>
        <button class="btn-ghost" onclick="restartFromModal()">
          <span data-i18n="resume.restart">Recommencer à zéro</span>
        </button>
      </div>
    </div>
  </div>

<script>
// ============================================================
// DATA
// ============================================================
const PILLARS_I18N = {
  fr: ["Shadow IA & Usages", "Souveraineté & Data", "Frugalité & Impact", "Éthique & Gouvernance", "Acculturation & Compétences"],
  en: ["Shadow AI & Usage", "Sovereignty & Data", "Frugality & Impact", "Ethics & Governance", "AI Literacy & Skills"],
  es: ["Shadow IA y Usos", "Soberanía y Datos", "Frugalidad e Impacto", "Ética y Gobernanza", "Aculturación y Competencias"]
};

var currentDiagLang = localStorage.getItem('homosapia_lang') || 'fr';
Object.defineProperty(window, 'PILLARS', { get: function() { return PILLARS_I18N[currentDiagLang] || PILLARS_I18N.fr; } });

const Q_TEXT = {
  en: [
    { text: "Do your employees use AI tools not approved by the company (ChatGPT, personal Copilot, etc.)?",
      answers: [
        { label: "No idea", desc: "we have no visibility on AI usage" },
        { label: "Likely", desc: "we know some use unofficial tools" },
        { label: "Identified", desc: "we have mapped unauthorized usage" },
        { label: "Controlled", desc: "clear policy with official tools deployed" }
      ] },
    { text: "Is sensitive data (clients, strategy, HR) being entered into consumer AI tools?",
      answers: [
        { label: "Very likely", desc: "no guidelines exist on this topic" },
        { label: "Possible", desc: "we discuss it but no real control" },
        { label: "Partially managed", desc: "guidelines exist but not consistently followed" },
        { label: "Under control", desc: "validated AI charter with data classification" }
      ] },
    { text: "Do you have a clear picture of the AI tools actually used in your organization?",
      answers: [
        { label: "Not at all", desc: "everyone uses whatever they want" },
        { label: "Partial inventory", desc: "we know about some tools being used" },
        { label: "Mapping in progress", desc: "usage audit launched" },
        { label: "Complete mapping", desc: "up-to-date inventory with risk/benefit assessment" }
      ] },
    { text: "Where is the data processed by your AI tools hosted?",
      answers: [
        { label: "No idea", desc: "we don't know where our data goes" },
        { label: "USA/non-EU", desc: "mainly with American providers (OpenAI, Google)" },
        { label: "Mixed", desc: "some European tools, others not" },
        { label: "Europe first", desc: "EU hosting and sovereign providers preferred" }
      ] },
    { text: "Does your company consider the European AI Act in its AI decisions?",
      answers: [
        { label: "Not aware", desc: "we don't know about the AI Act" },
        { label: "Basic awareness", desc: "we know it exists but no concrete impact" },
        { label: "Under review", desc: "we're assessing implications for our business" },
        { label: "Integrated", desc: "the AI Act is factored into our tool choices and processes" }
      ] },
    { text: "Is your data structured and ready to feed AI tools?",
      answers: [
        { label: "Scattered", desc: "data in silos, not exploitable" },
        { label: "Partially centralized", desc: "but insufficient quality" },
        { label: "Structured", desc: "accessible and sufficient quality" },
        { label: "Optimized", desc: "data pipeline in place, qualified and documented data" }
      ] },
    { text: "Do you consider the environmental impact of your AI usage?",
      answers: [
        { label: "Not at all", desc: "the topic is never mentioned" },
        { label: "Awareness", desc: "we talk about it but no concrete measures" },
        { label: "Selection criterion", desc: "environmental impact is one criterion among others" },
        { label: "Active policy", desc: "systematic choice of lightweight and frugal models when possible" }
      ] },
    { text: "Do you use AI models suited to the complexity of your tasks (not GPT-4 for a simple summary)?",
      answers: [
        { label: "One model for everything", desc: "always the most powerful by default" },
        { label: "No thought given", desc: "we use what we know" },
        { label: "Partial differentiation", desc: "some choose the right model per task" },
        { label: "Frugal strategy", desc: "systematic choice of adapted model (cost, energy, performance)" }
      ] },
    { text: "Do you measure the ROI of your AI usage (time saved, quality, costs)?",
      answers: [
        { label: "No measurement", desc: "we use AI without measuring impact" },
        { label: "Gut feeling", desc: "we think it helps but no data" },
        { label: "Some metrics", desc: "on certain use cases" },
        { label: "Systematic ROI", desc: "every AI use case is measured and documented" }
      ] },
    { text: "Do you have an AI charter or defined ethical principles?",
      answers: [
        { label: "No charter", desc: "the topic hasn't been addressed" },
        { label: "Under consideration", desc: "the need is identified but nothing formalized" },
        { label: "Charter in progress", desc: "document being drafted/validated" },
        { label: "Active charter", desc: "charter validated, distributed and enforced" }
      ] },
    { text: "Who validates decisions made with AI assistance in your organization?",
      answers: [
        { label: "Nobody", desc: "AI is used without supervision" },
        { label: "The user alone", desc: "each person judges relevance" },
        { label: "Partial process", desc: "human validation on certain sensitive cases" },
        { label: "Human-in-the-loop", desc: "systematic human validation on critical decisions" }
      ] },
    { text: "Are your teams aware of AI biases and risks (hallucinations, bias, misinformation)?",
      answers: [
        { label: "Not at all", desc: "no training or awareness" },
        { label: "Vaguely", desc: "some articles shared" },
        { label: "One-off training", desc: "at least one awareness session completed" },
        { label: "Integrated", desc: "continuous awareness with practical cases and internal guides" }
      ] },
    { text: "What is your teams' AI skill level?",
      answers: [
        { label: "No skills", desc: "no internal AI training" },
        { label: "Some self-taught", desc: "experimenting on their own" },
        { label: "One-off training", desc: "training sessions have been conducted" },
        { label: "Structured program", desc: "AI upskilling plan in place" }
      ] },
    { text: "Does your leadership champion AI adoption as a strategic topic?",
      answers: [
        { label: "Not at all", desc: "the topic is not on the executive agenda" },
        { label: "Declared interest", desc: "leadership talks about it but no action" },
        { label: "Identified sponsor", desc: "a leadership member drives the topic" },
        { label: "Integrated vision", desc: "AI roadmap aligned with business strategy" }
      ] },
    { text: "Do you have AI champions or referents internally?",
      answers: [
        { label: "No referent", desc: "nobody is identified on the topic" },
        { label: "1-2 motivated", desc: "but not officially mandated" },
        { label: "Designated referents", desc: "in some departments" },
        { label: "Structured network", desc: "AI champions with coordination and CDO/AI lead" }
      ] }
  ],
  es: [
    { text: "\u00bfSus colaboradores utilizan herramientas IA no aprobadas por la empresa (ChatGPT, Copilot personal, etc.)?",
      answers: [
        { label: "Sin idea", desc: "no tenemos visibilidad sobre los usos de IA" },
        { label: "Probable", desc: "sabemos que algunos usan herramientas no oficiales" },
        { label: "Identificado", desc: "hemos mapeado los usos no autorizados" },
        { label: "Controlado", desc: "pol\u00edtica clara con herramientas oficiales desplegadas" }
      ] },
    { text: "\u00bfSe ingresan datos sensibles (clientes, estrategia, RRHH) en herramientas IA de consumo masivo?",
      answers: [
        { label: "Muy probable", desc: "no existe ninguna directriz al respecto" },
        { label: "Posible", desc: "se habla pero sin control real" },
        { label: "Parcialmente gestionado", desc: "existen directrices pero no se siguen sistem\u00e1ticamente" },
        { label: "Bajo control", desc: "carta IA validada con clasificaci\u00f3n de datos" }
      ] },
    { text: "\u00bfTiene una visi\u00f3n clara de las herramientas IA realmente utilizadas en su organizaci\u00f3n?",
      answers: [
        { label: "Para nada", desc: "cada uno usa lo que quiere" },
        { label: "Inventario parcial", desc: "conocemos algunas herramientas utilizadas" },
        { label: "Mapeo en curso", desc: "auditor\u00eda de usos iniciada" },
        { label: "Mapeo completo", desc: "inventario actualizado con evaluaci\u00f3n riesgos/beneficios" }
      ] },
    { text: "\u00bfD\u00f3nde est\u00e1n alojados los datos procesados por sus herramientas IA?",
      answers: [
        { label: "Sin idea", desc: "no sabemos d\u00f3nde van nuestros datos" },
        { label: "EEUU/fuera UE", desc: "principalmente con proveedores americanos (OpenAI, Google)" },
        { label: "Mixto", desc: "algunas herramientas europeas, otras no" },
        { label: "Europa prioritaria", desc: "alojamiento UE y proveedores soberanos priorizados" }
      ] },
    { text: "\u00bfSu empresa tiene en cuenta el AI Act europeo en sus decisiones de IA?",
      answers: [
        { label: "No informados", desc: "no conocemos el AI Act" },
        { label: "Conocimiento b\u00e1sico", desc: "sabemos que existe pero sin impacto concreto" },
        { label: "En an\u00e1lisis", desc: "evaluamos las implicaciones para nuestra actividad" },
        { label: "Integrado", desc: "el AI Act se tiene en cuenta en nuestras elecciones de herramientas" }
      ] },
    { text: "\u00bfSus datos est\u00e1n estructurados y listos para alimentar herramientas IA?",
      answers: [
        { label: "Dispersos", desc: "datos en silos, no explotables" },
        { label: "Parcialmente centralizados", desc: "pero calidad insuficiente" },
        { label: "Estructurados", desc: "accesibles y calidad suficiente" },
        { label: "Optimizados", desc: "pipeline de datos implementado, datos cualificados y documentados" }
      ] },
    { text: "\u00bfTiene en cuenta el impacto ambiental de sus usos de IA?",
      answers: [
        { label: "Para nada", desc: "el tema nunca se menciona" },
        { label: "Sensibilidad", desc: "se habla pero sin medida concreta" },
        { label: "Criterio de selecci\u00f3n", desc: "el impacto ambiental es un criterio entre otros" },
        { label: "Pol\u00edtica activa", desc: "elecci\u00f3n sistem\u00e1tica de modelos ligeros y frugales cuando es posible" }
      ] },
    { text: "\u00bfUtiliza modelos IA adaptados a la complejidad de sus tareas (no GPT-4 para un simple resumen)?",
      answers: [
        { label: "Un solo modelo para todo", desc: "siempre el m\u00e1s potente por defecto" },
        { label: "Sin reflexi\u00f3n", desc: "usamos lo que conocemos" },
        { label: "Diferenciaci\u00f3n parcial", desc: "algunos eligen el modelo adecuado seg\u00fan la tarea" },
        { label: "Estrategia frugal", desc: "elecci\u00f3n sistem\u00e1tica del modelo adaptado (coste, energ\u00eda, rendimiento)" }
      ] },
    { text: "\u00bfMide el ROI de sus usos de IA (tiempo ahorrado, calidad, costes)?",
      answers: [
        { label: "Sin medici\u00f3n", desc: "usamos IA sin medir el impacto" },
        { label: "Sensaci\u00f3n", desc: "pensamos que ayuda pero sin datos" },
        { label: "Algunas m\u00e9tricas", desc: "en ciertos casos de uso" },
        { label: "ROI sistem\u00e1tico", desc: "cada uso de IA se mide y documenta" }
      ] },
    { text: "\u00bfTiene una carta IA o principios \u00e9ticos definidos?",
      answers: [
        { label: "Ninguna carta", desc: "el tema no se ha abordado" },
        { label: "En reflexi\u00f3n", desc: "la necesidad est\u00e1 identificada pero nada formalizado" },
        { label: "Carta en curso", desc: "documento en redacci\u00f3n/validaci\u00f3n" },
        { label: "Carta activa", desc: "carta validada, difundida y aplicada" }
      ] },
    { text: "\u00bfQui\u00e9n valida las decisiones tomadas con ayuda de la IA en su organizaci\u00f3n?",
      answers: [
        { label: "Nadie", desc: "la IA se usa sin supervisi\u00f3n" },
        { label: "El usuario solo", desc: "cada uno juzga la pertinencia" },
        { label: "Proceso parcial", desc: "validaci\u00f3n humana en ciertos casos sensibles" },
        { label: "Human-in-the-loop", desc: "validaci\u00f3n humana sistem\u00e1tica en decisiones cr\u00edticas" }
      ] },
    { text: "\u00bfSus equipos est\u00e1n sensibilizados sobre sesgos y riesgos de la IA (alucinaciones, sesgos, desinformaci\u00f3n)?",
      answers: [
        { label: "Para nada", desc: "ninguna formaci\u00f3n o sensibilizaci\u00f3n" },
        { label: "Vagamente", desc: "algunos art\u00edculos compartidos" },
        { label: "Formaci\u00f3n puntual", desc: "al menos una sesi\u00f3n de sensibilizaci\u00f3n realizada" },
        { label: "Integrado", desc: "sensibilizaci\u00f3n continua con casos pr\u00e1cticos y gu\u00edas internas" }
      ] },
    { text: "\u00bfCu\u00e1l es el nivel de competencia IA de sus equipos?",
      answers: [
        { label: "Sin competencia", desc: "sin formaci\u00f3n IA interna" },
        { label: "Algunos autodidactas", desc: "experimentando por su cuenta" },
        { label: "Formaciones puntuales", desc: "se han realizado formaciones" },
        { label: "Programa estructurado", desc: "plan de capacitaci\u00f3n IA implementado" }
      ] },
    { text: "\u00bfSu direcci\u00f3n impulsa la adopci\u00f3n de IA como tema estrat\u00e9gico?",
      answers: [
        { label: "Para nada", desc: "el tema no est\u00e1 en la agenda del comit\u00e9 de direcci\u00f3n" },
        { label: "Inter\u00e9s declarado", desc: "la direcci\u00f3n habla pero sin acci\u00f3n" },
        { label: "Sponsor identificado", desc: "un miembro de la direcci\u00f3n impulsa el tema" },
        { label: "Visi\u00f3n integrada", desc: "hoja de ruta IA alineada con la estrategia de la empresa" }
      ] },
    { text: "\u00bfTiene referentes o champions IA internos?",
      answers: [
        { label: "Ning\u00fan referente", desc: "nadie est\u00e1 identificado en el tema" },
        { label: "1-2 motivados", desc: "pero no mandatados oficialmente" },
        { label: "Referentes designados", desc: "en algunos departamentos" },
        { label: "Red estructurada", desc: "champions IA con coordinaci\u00f3n y CDO/responsable IA" }
      ] }
  ]
};

const RECO_TEXT = {
  en: {
    0: { insight: "Shadow AI is a major risk for your organization. Sensitive data is likely flowing through uncontrolled tools.", action: "Immediately map existing AI usage and deploy official tools. A Shadow AI audit is the first step.", offer: "AI & Operational Audit" },
    1: { insight: "Your digital sovereignty is a blind spot. In a European regulatory context (AI Act, GDPR), this is a growing risk.", action: "Assess your technology dependencies and structure a sovereign data strategy with European alternatives.", offer: "Full Consulting" },
    2: { insight: "Your AI usage lacks frugality. Without impact measurement, you can't optimize costs or footprint.", action: "Implement ROI metrics and adopt a frugal approach: the right model for the right task.", offer: "Hands-on Workshops" },
    3: { insight: "The lack of an ethical framework exposes your organization to bias, hallucinations, and reputational risks.", action: "Co-create an AI charter with your teams and implement human validation processes for critical uses.", offer: "Pilot Project & Deployment" },
    4: { insight: "AI literacy is insufficient for lasting transformation. Without internal skills, external dependency grows.", action: "Launch an AI training program adapted to each level (C-suite, managers, operational teams) with internal referents.", offer: "AI Training" }
  },
  es: {
    0: { insight: "La Shadow IA es un riesgo mayor para su organizaci\u00f3n. Datos sensibles probablemente circulan por herramientas no controladas.", action: "Cartograf\u00ede inmediatamente los usos IA existentes y despliegue herramientas oficiales. Una auditor\u00eda Shadow IA es el primer paso.", offer: "Auditor\u00eda IA y operativa" },
    1: { insight: "Su soberan\u00eda digital es un punto ciego. En un contexto regulatorio europeo (AI Act, RGPD), es un riesgo creciente.", action: "Eval\u00fae sus dependencias tecnol\u00f3gicas y estructure una estrategia de datos soberana con alternativas europeas.", offer: "Acompa\u00f1amiento integral" },
    2: { insight: "Sus usos de IA carecen de frugalidad. Sin medici\u00f3n de impacto, no puede optimizar costes ni huella.", action: "Implemente m\u00e9tricas de ROI y adopte un enfoque frugal: el modelo adecuado para la tarea adecuada.", offer: "Talleres pr\u00e1cticos" },
    3: { insight: "La ausencia de marco \u00e9tico expone su organizaci\u00f3n a sesgos, alucinaciones y riesgos reputacionales.", action: "Co-construya una carta IA con sus equipos e implemente procesos de validaci\u00f3n humana en usos cr\u00edticos.", offer: "Proyecto piloto y despliegue" },
    4: { insight: "El nivel de aculturaci\u00f3n IA es insuficiente para una transformaci\u00f3n duradera. Sin competencias internas, la dependencia externa crece.", action: "Lance un programa de formaci\u00f3n IA adaptado a cada nivel (directivos, mandos, operativos) con referentes internos.", offer: "Formaciones IA" }
  }
};

const QUESTIONS = [
  // Pilier 1 : Shadow IA & Usages
  {
    pillar: 0,
    text: "Vos collaborateurs utilisent-ils des outils IA non validés par l'entreprise (ChatGPT, Copilot perso, etc.) ?",
    answers: [
      { label: "Aucune idée", desc: "nous n'avons aucune visibilité sur les usages IA", score: 1 },
      { label: "Probable", desc: "nous savons que certains utilisent des outils non officiels", score: 2 },
      { label: "Identifié", desc: "nous avons cartographié les usages non encadrés", score: 3 },
      { label: "Maîtrisé", desc: "politique claire avec outils officiels déployés", score: 4 }
    ]
  },
  {
    pillar: 0,
    text: "Des données sensibles (clients, stratégie, RH) sont-elles saisies dans des outils IA grand public ?",
    answers: [
      { label: "Très probable", desc: "aucune consigne n'existe sur ce sujet", score: 1 },
      { label: "Possible", desc: "on en parle mais pas de contrôle réel", score: 2 },
      { label: "Encadré partiellement", desc: "des consignes existent mais ne sont pas systématiquement suivies", score: 3 },
      { label: "Sous contrôle", desc: "charte IA validée avec classification des données", score: 4 }
    ]
  },
  {
    pillar: 0,
    text: "Avez-vous une vision claire des outils IA réellement utilisés dans votre organisation ?",
    answers: [
      { label: "Pas du tout", desc: "chacun utilise ce qu'il veut", score: 1 },
      { label: "Inventaire partiel", desc: "nous connaissons quelques outils utilisés", score: 2 },
      { label: "Cartographie en cours", desc: "audit des usages lancé", score: 3 },
      { label: "Cartographie complète", desc: "inventaire à jour avec évaluation risques/bénéfices", score: 4 }
    ]
  },
  // Pilier 2 : Souveraineté & Data
  {
    pillar: 1,
    text: "Où sont hébergées les données traitées par vos outils IA ?",
    answers: [
      { label: "Aucune idée", desc: "nous ne savons pas où vont nos données", score: 1 },
      { label: "USA/hors UE", desc: "principalement chez des acteurs américains (OpenAI, Google)", score: 2 },
      { label: "Mixte", desc: "certains outils européens, d'autres non", score: 3 },
      { label: "Europe prioritaire", desc: "hébergement UE et fournisseurs souverains privilégiés", score: 4 }
    ]
  },
  {
    pillar: 1,
    text: "Votre entreprise prend-elle en compte l'AI Act européen dans ses choix IA ?",
    answers: [
      { label: "Pas informés", desc: "nous ne connaissons pas l'AI Act", score: 1 },
      { label: "Connaissance basique", desc: "on sait que ça existe mais sans impact concret", score: 2 },
      { label: "En analyse", desc: "nous évaluons les implications pour notre activité", score: 3 },
      { label: "Intégré", desc: "l'AI Act est pris en compte dans nos choix d'outils et processus", score: 4 }
    ]
  },
  {
    pillar: 1,
    text: "Vos données sont-elles structurées et prêtes pour alimenter des outils IA ?",
    answers: [
      { label: "Dispersées", desc: "données en silos, pas exploitables", score: 1 },
      { label: "Partiellement centralisées", desc: "mais qualité insuffisante", score: 2 },
      { label: "Structurées", desc: "accessibles et de qualité suffisante", score: 3 },
      { label: "Optimisées", desc: "data pipeline en place, données qualifiées et documentées", score: 4 }
    ]
  },
  // Pilier 3 : Frugalité & Impact
  {
    pillar: 2,
    text: "Prenez-vous en compte l'impact environnemental de vos usages IA ?",
    answers: [
      { label: "Pas du tout", desc: "le sujet n'est jamais évoqué", score: 1 },
      { label: "Sensibilité", desc: "on en parle mais sans mesure concrète", score: 2 },
      { label: "Critère de choix", desc: "l'impact environnemental est un critère parmi d'autres", score: 3 },
      { label: "Politique active", desc: "choix systématique de modèles légers et frugaux quand c'est possible", score: 4 }
    ]
  },
  {
    pillar: 2,
    text: "Utilisez-vous des modèles IA adaptés à la complexité de vos tâches (pas de GPT-4 pour un simple résumé) ?",
    answers: [
      { label: "Un seul modèle pour tout", desc: "toujours le plus puissant par défaut", score: 1 },
      { label: "Pas de réflexion", desc: "on utilise ce qu'on connaît", score: 2 },
      { label: "Différenciation partielle", desc: "certains choisissent le bon modèle selon la tâche", score: 3 },
      { label: "Stratégie frugale", desc: "choix systématique du modèle adapté (coût, énergie, performance)", score: 4 }
    ]
  },
  {
    pillar: 2,
    text: "Mesurez-vous le ROI de vos usages IA (temps gagné, qualité, coûts) ?",
    answers: [
      { label: "Aucune mesure", desc: "on utilise l'IA sans mesurer l'impact", score: 1 },
      { label: "Ressenti", desc: "on pense que ça aide mais pas de données", score: 2 },
      { label: "Quelques métriques", desc: "sur certains cas d'usage", score: 3 },
      { label: "ROI systématique", desc: "chaque usage IA est mesuré et documenté", score: 4 }
    ]
  },
  // Pilier 4 : Éthique & Gouvernance
  {
    pillar: 3,
    text: "Avez-vous une charte IA ou des principes éthiques définis ?",
    answers: [
      { label: "Aucune charte", desc: "le sujet n'a pas été abordé", score: 1 },
      { label: "En réflexion", desc: "le besoin est identifié mais rien de formalisé", score: 2 },
      { label: "Charte en cours", desc: "document en cours de rédaction / validation", score: 3 },
      { label: "Charte active", desc: "charte validée, diffusée et appliquée", score: 4 }
    ]
  },
  {
    pillar: 3,
    text: "Qui valide les décisions prises avec l'aide de l'IA dans votre organisation ?",
    answers: [
      { label: "Personne", desc: "l'IA est utilisée sans supervision", score: 1 },
      { label: "L'utilisateur seul", desc: "chacun juge de la pertinence", score: 2 },
      { label: "Processus partiel", desc: "validation humaine sur certains cas sensibles", score: 3 },
      { label: "Human-in-the-loop", desc: "validation humaine systématique sur les décisions critiques", score: 4 }
    ]
  },
  {
    pillar: 3,
    text: "Vos équipes sont-elles sensibilisées aux biais et risques de l'IA (hallucinations, biais, désinformation) ?",
    answers: [
      { label: "Pas du tout", desc: "aucune formation ou sensibilisation", score: 1 },
      { label: "Vaguement", desc: "quelques articles partagés", score: 2 },
      { label: "Formation ponctuelle", desc: "au moins une session de sensibilisation réalisée", score: 3 },
      { label: "Intégré", desc: "sensibilisation continue avec cas pratiques et guides internes", score: 4 }
    ]
  },
  // Pilier 5 : Acculturation & Compétences
  {
    pillar: 4,
    text: "Quel est le niveau de compétence IA de vos équipes ?",
    answers: [
      { label: "Aucune compétence", desc: "pas de formation IA en interne", score: 1 },
      { label: "Quelques autodidactes", desc: "qui expérimentent par eux-mêmes", score: 2 },
      { label: "Formations ponctuelles", desc: "des formations ont été réalisées", score: 3 },
      { label: "Programme structuré", desc: "plan de montée en compétences IA en place", score: 4 }
    ]
  },
  {
    pillar: 4,
    text: "Votre direction porte-t-elle l'adoption IA comme un sujet stratégique ?",
    answers: [
      { label: "Pas du tout", desc: "le sujet n'est pas à l'agenda du CODIR", score: 1 },
      { label: "Intérêt déclaré", desc: "le CODIR en parle mais pas d'action", score: 2 },
      { label: "Sponsor identifié", desc: "un membre du CODIR porte le sujet", score: 3 },
      { label: "Vision intégrée", desc: "roadmap IA alignée sur la stratégie d'entreprise", score: 4 }
    ]
  },
  {
    pillar: 4,
    text: "Avez-vous des référents ou champions IA en interne ?",
    answers: [
      { label: "Aucun référent", desc: "personne n'est identifié sur le sujet", score: 1 },
      { label: "1-2 motivés", desc: "mais pas mandatés officiellement", score: 2 },
      { label: "Référents désignés", desc: "dans certains services", score: 3 },
      { label: "Réseau structuré", desc: "champions IA avec coordination et CDO/responsable IA", score: 4 }
    ]
  }
];

const RECOMMENDATIONS = {
  0: {
    insight: "La Shadow IA est un risque majeur pour votre organisation. Des données sensibles circulent probablement sur des outils non maîtrisés.",
    action: "Cartographiez immédiatement les usages IA existants et déployez des outils officiels. Un audit Shadow IA est la première étape.",
    offer: "Audit IA & opérationnel",
    link: "https://homosapia.com#offres"
  },
  1: {
    insight: "Votre souveraineté numérique est un angle mort. Dans un contexte réglementaire européen (AI Act, RGPD), c'est un risque croissant.",
    action: "Évaluez vos dépendances technologiques et structurez une stratégie data souveraine avec des alternatives européennes.",
    offer: "Accompagnement global",
    link: "https://homosapia.com#offres"
  },
  2: {
    insight: "Vos usages IA manquent de sobriété. Sans mesure d'impact, vous ne pouvez pas optimiser vos coûts ni votre empreinte.",
    action: "Mettez en place des métriques de ROI et adoptez une approche frugale : le bon modèle pour la bonne tâche.",
    offer: "Ateliers pratiques",
    link: "https://homosapia.com#offres"
  },
  3: {
    insight: "L'absence de cadre éthique expose votre organisation aux biais, hallucinations et risques réputationnels liés à l'IA.",
    action: "Co-construisez une charte IA avec vos équipes et mettez en place des processus de validation humaine sur les usages critiques.",
    offer: "Projet pilote & déploiement",
    link: "https://homosapia.com#offres"
  },
  4: {
    insight: "Le niveau d'acculturation IA est insuffisant pour une transformation pérenne. Sans compétences internes, la dépendance externe grandit.",
    action: "Lancez un programme de formation IA adapté à chaque niveau (CODIR, managers, opérationnels) avec des référents internes.",
    offer: "Formations IA",
    link: "https://homosapia.com#offres"
  }
};

// ============================================================
// STATE
// ============================================================
let currentQuestion = 0;
let answers = new Array(15).fill(null);
let companyProfile = { name: '', role: '', sector: '', size: '', website: '' };

function loadState() {
  try {
    const saved = localStorage.getItem('homosapia_diag');
    if (saved) {
      const data = JSON.parse(saved);
      if (data.answers) answers = data.answers;
      if (data.currentQuestion !== undefined) currentQuestion = data.currentQuestion;
      if (data.companyProfile) companyProfile = data.companyProfile;
    }
  } catch(e) {}
}

function saveState() {
  try {
    localStorage.setItem('homosapia_diag', JSON.stringify({
      answers,
      currentQuestion,
      companyProfile
    }));
  } catch(e) {}
}

// ============================================================
// NAVIGATION
// ============================================================
function showSection(id) {
  document.querySelectorAll('.section').forEach(s => {
    s.classList.remove('active', 'visible');
  });
  const section = document.getElementById(id);
  section.classList.add('active');
  window.scrollTo({ top: 0, behavior: 'instant' });
  requestAnimationFrame(() => {
    requestAnimationFrame(() => {
      section.classList.add('visible');
    });
  });
}

function showStep0() {
  showSection('sectionProfile');
  if (companyProfile.name) document.getElementById('companyName').value = companyProfile.name;
  if (companyProfile.website) document.getElementById('companyWebsite').value = companyProfile.website;
  if (companyProfile.role) document.getElementById('role').value = companyProfile.role;
  if (companyProfile.sector) document.getElementById('sector').value = companyProfile.sector;
  if (companyProfile.size) document.getElementById('size').value = companyProfile.size;
}

function startDiagnostic() {
  companyProfile.name = document.getElementById('companyName').value.trim();
  companyProfile.website = document.getElementById('companyWebsite').value.trim();
  companyProfile.role = document.getElementById('role').value;
  companyProfile.sector = document.getElementById('sector').value;
  companyProfile.size = document.getElementById('size').value;

  if (!companyProfile.name || !companyProfile.role || !companyProfile.sector || !companyProfile.size) {
    ['companyName', 'role', 'sector', 'size'].forEach(id => {
      const el = document.getElementById(id);
      if (!el.value || el.value === '') {
        el.style.borderColor = 'var(--accent)';
        setTimeout(() => { el.style.borderColor = ''; }, 2000);
      }
    });
    return;
  }

  saveState();
  document.getElementById('progressInline').classList.add('visible');
  showSection('sectionQuestions');
  renderQuestion();
}

// ============================================================
// QUESTIONS
// ============================================================
function renderQuestion() {
  const q = QUESTIONS[currentQuestion];
  const lang = window.diagLang ? window.diagLang() : 'fr';
  const pillarName = (PILLARS_I18N[lang] || PILLARS_I18N.fr)[q.pillar];

  const qPrefix = lang === 'es' ? 'Pregunta' : lang === 'en' ? 'Question' : 'Question';
  document.getElementById('qStep').textContent = `${qPrefix} ${currentQuestion + 1} / 15`;
  document.getElementById('qPillar').textContent = pillarName;

  // Get translated text if available
  const qTrans = (Q_TEXT[lang] && Q_TEXT[lang][currentQuestion]) ? Q_TEXT[lang][currentQuestion] : null;
  document.getElementById('qText').textContent = qTrans ? qTrans.text : q.text;

  // Progress bar (inline)
  const pct = ((currentQuestion + 1) / 15) * 100;
  document.getElementById('progressFill').style.width = pct + '%';
  var pLabel = document.getElementById('progressLabel');
  if (pLabel) pLabel.textContent = `${currentQuestion + 1} sur 15`;
  var pPct = document.getElementById('progressPct');
  if (pPct) pPct.textContent = Math.round(pct) + '%';
  // Dots: 15 dots, one per question
  var dotsEl = document.getElementById('progressDots');
  if (dotsEl) {
    dotsEl.innerHTML = '';
    for (var d = 0; d < 15; d++) {
      var dot = document.createElement('span');
      dot.className = 'progress-inline-dot' + (d < currentQuestion ? ' done' : d === currentQuestion ? ' active' : '');
      dotsEl.appendChild(dot);
    }
  }

  // Answer cards
  const container = document.getElementById('answerCards');
  container.innerHTML = '';

  q.answers.forEach((a, idx) => {
    const aTrans = qTrans ? qTrans.answers[idx] : null;
    const card = document.createElement('div');
    card.className = 'answer-card' + (answers[currentQuestion] === idx ? ' selected' : '');
    card.innerHTML = `
      <div class="answer-indicator">${idx + 1}</div>
      <div class="answer-label">
        <strong>${aTrans ? aTrans.label : a.label}</strong> <span>- ${aTrans ? aTrans.desc : a.desc}</span>
      </div>
    `;
    card.addEventListener('click', () => selectAnswer(idx, card));
    container.appendChild(card);
  });

  // Back button visibility
  document.getElementById('btnPrev').style.visibility = currentQuestion === 0 ? 'hidden' : 'visible';

  updateNextBtn();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function selectAnswer(idx, card) {
  answers[currentQuestion] = idx;
  saveState();

  document.querySelectorAll('.answer-card').forEach(c => c.classList.remove('selected'));
  card.classList.add('selected', 'flash');
  setTimeout(() => card.classList.remove('flash'), 300);

  updateNextBtn();

  // Auto-advance after brief highlight
  setTimeout(() => {
    if (currentQuestion < 14) {
      nextQuestion();
    } else {
      showGate();
    }
  }, 400);
}

function updateNextBtn() {
  const lang = window.diagLang ? window.diagLang() : 'fr';
  const btn = document.getElementById('btnNext');
  const seeResults = lang === 'es' ? 'Ver mis resultados' : lang === 'en' ? 'See my results' : 'Voir mes résultats';
  const next = lang === 'es' ? 'Siguiente' : lang === 'en' ? 'Next' : 'Suivant';
  if (answers[currentQuestion] !== null) {
    btn.classList.add('enabled');
    btn.innerHTML = currentQuestion === 14
      ? seeResults + ' <span>&rarr;</span>'
      : next + ' <span>&rarr;</span>';
  } else {
    btn.classList.remove('enabled');
    btn.innerHTML = next + ' <span>&rarr;</span>';
  }
}

function nextQuestion() {
  if (answers[currentQuestion] === null) return;
  if (currentQuestion < 14) {
    currentQuestion++;
    saveState();
    renderQuestion();
  } else {
    showGate();
  }
}

// ============================================================
// GATE (lead capture before results)
// ============================================================
let leadContact = { firstname: '', lastname: '', email: '', phone: '' };

function showGate() {
  document.getElementById('progressInline').classList.remove('visible');

  showSection('sectionGate');
  // Restore saved contact info
  try {
    const saved = localStorage.getItem('homosapia_diag_contact');
    if (saved) {
      leadContact = JSON.parse(saved);
      if (leadContact.firstname) document.getElementById('gateFirstname').value = leadContact.firstname;
      if (leadContact.lastname) document.getElementById('gateLastname').value = leadContact.lastname;
      if (leadContact.email) document.getElementById('gateEmail').value = leadContact.email;
      if (leadContact.phone) document.getElementById('gatePhone').value = leadContact.phone;
    }
  } catch(e) {}
}

function submitGate() {
  const firstname = document.getElementById('gateFirstname').value.trim();
  const lastname = document.getElementById('gateLastname').value.trim();
  const email = document.getElementById('gateEmail').value.trim();
  const phone = document.getElementById('gatePhone').value.trim();

  // Validate required fields
  let hasError = false;
  ['gateFirstname', 'gateLastname', 'gateEmail'].forEach(id => {
    const el = document.getElementById(id);
    const val = el.value.trim();
    if (!val || (id === 'gateEmail' && !val.includes('@'))) {
      el.style.borderColor = 'var(--accent)';
      setTimeout(() => { el.style.borderColor = ''; }, 2500);
      hasError = true;
    }
  });
  if (hasError) return;

  leadContact = { firstname, lastname, email, phone };
  try {
    localStorage.setItem('homosapia_diag_contact', JSON.stringify(leadContact));
  } catch(e) {}

  // Show loading state
  document.querySelector('.gate-actions').style.display = 'none';
  document.querySelector('.gate-trust').style.display = 'none';
  document.getElementById('gateLoading').style.display = 'flex';

  // Calculate scores for webhook
  const pillarScores = [0, 0, 0, 0, 0];
  QUESTIONS.forEach((q, i) => {
    if (answers[i] !== null) {
      pillarScores[q.pillar] += q.answers[answers[i]].score;
    }
  });
  const totalScoreRaw = pillarScores.reduce((a, b) => a + b, 0);
  // Convert to /100 scale (raw: 15 questions × 4 = 60 max → /100 total, /20 per pillar)
  const totalScore = Math.round(totalScoreRaw * 100 / 60);
  const pillarScores100 = pillarScores.map(s => Math.round(s * 20 / 12));

  // Build full diagnostic payload
  const currentLang = window.currentDiagLang || localStorage.getItem('homosapia_lang') || 'fr';
  const payload = {
    lang: currentLang,
    contact: leadContact,
    company: companyProfile,
    scores: {
      total: totalScore,
      maxTotal: 100,
      pct: totalScore,
      pillars: PILLARS_I18N.fr.map((name, i) => ({
        name,
        score: pillarScores100[i],
        max: 20,
        pct: Math.round((pillarScores100[i] / 20) * 100)
      }))
    },
    answers: QUESTIONS.map((q, i) => ({
      pillar: PILLARS_I18N.fr[q.pillar],
      question: q.text,
      answer: answers[i] !== null ? q.answers[answers[i]].label : null,
      answerDetail: answers[i] !== null ? q.answers[answers[i]].desc : null,
      score: answers[i] !== null ? q.answers[answers[i]].score : null
    })),
    level: totalScore < 42 ? 'Éveil' : totalScore < 62 ? 'Exploration' : totalScore < 82 ? 'Accélération' : 'Excellence',
    timestamp: new Date().toISOString()
  };

  // Send to webhook (fire and forget, show results immediately)
  sendToWebhook(payload);

  // Show results after brief delay
  setTimeout(() => {
    document.getElementById('sentToEmail').textContent = email;
    document.getElementById('reportSent').style.display = 'block';
    showResults();
  }, 1500);
}

async function sendToWebhook(payload) {
  try {
    await fetch('/api/diagnostic', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
  } catch(e) {
    // Silently fail — results still show
    console.log('Webhook send failed:', e);
  }
}

function prevQuestion() {
  if (currentQuestion > 0) {
    currentQuestion--;
    saveState();
    renderQuestion();
  } else {
    document.getElementById('progressInline').classList.remove('visible');

    showSection('sectionProfile');
  }
}

// ============================================================
// RESULTS
// ============================================================
function showResults() {
  document.getElementById('progressInline').classList.remove('visible');

  showSection('sectionResults');

  const pillarScores = [0, 0, 0, 0, 0];
  QUESTIONS.forEach((q, i) => {
    if (answers[i] !== null) {
      pillarScores[q.pillar] += q.answers[answers[i]].score;
    }
  });

  const totalScoreRaw = pillarScores.reduce((a, b) => a + b, 0);
  // Convert to /100 scale
  const totalScore = Math.round(totalScoreRaw * 100 / 60);
  const pillarScores100 = pillarScores.map(s => Math.round(s * 20 / 12));

  const companyEl = document.getElementById('resultsCompany');
  companyEl.textContent = companyProfile.name ? companyProfile.name : '';

  renderScoreCircle(totalScore);
  renderLevel(totalScore);
  renderRadar(pillarScores100);
  renderPillarBars(pillarScores100);
  renderRecommendations(pillarScores100);
}

function renderScoreCircle(score) {
  const circumference = 2 * Math.PI * 88;
  const pct = score / 100;
  const offset = circumference * (1 - pct);

  const fill = document.getElementById('scoreCircleFill');

  let color;
  if (score < 42) color = '#E85D3A';
  else if (score < 62) color = '#F2993A';
  else if (score < 82) color = '#3A8FF2';
  else color = '#4CAF50';

  fill.setAttribute('stroke', color);
  fill.setAttribute('stroke-dasharray', circumference);

  setTimeout(() => {
    fill.setAttribute('stroke-dashoffset', offset);
  }, 200);

  // Animated counter
  const numEl = document.getElementById('scoreNumber');
  let current = 0;
  const duration = 1200;
  const step = score / (duration / 16);
  function animate() {
    current += step;
    if (current >= score) {
      numEl.textContent = score;
      return;
    }
    numEl.textContent = Math.floor(current);
    requestAnimationFrame(animate);
  }
  animate();
}

function renderLevel(score) {
  const lang = window.diagLang ? window.diagLang() : 'fr';
  const levelEl = document.getElementById('scoreLevel');
  const descEl = document.getElementById('scoreLevelDesc');

  const levels = {
    fr: [
      { name: '\u00c9veil', desc: "Votre entreprise est au d\u00e9but de sa r\u00e9flexion IA. Tout reste \u00e0 construire, mais c'est une opportunit\u00e9 formidable." },
      { name: 'Exploration', desc: "Des bases existent, il faut structurer. Vous avez l'avantage de ne pas partir de z\u00e9ro." },
      { name: 'Acc\u00e9l\u00e9ration', desc: "Vous avez de bonnes fondations. Il est temps de passer \u00e0 l'\u00e9chelle et d'industrialiser vos initiatives." },
      { name: 'Excellence', desc: "Votre maturit\u00e9 IA est avanc\u00e9e. Concentrez-vous sur l'optimisation et l'innovation continue." }
    ],
    en: [
      { name: 'Awakening', desc: "Your company is at the beginning of its AI journey. Everything is yet to be built, but it's a tremendous opportunity." },
      { name: 'Exploration', desc: "Foundations exist, they need structure. You have the advantage of not starting from scratch." },
      { name: 'Acceleration', desc: "You have solid foundations. It's time to scale up and industrialize your initiatives." },
      { name: 'Excellence', desc: "Your AI maturity is advanced. Focus on optimization and continuous innovation." }
    ],
    es: [
      { name: 'Despertar', desc: "Su empresa est\u00e1 al inicio de su reflexi\u00f3n IA. Todo est\u00e1 por construir, pero es una oportunidad formidable." },
      { name: 'Exploraci\u00f3n', desc: "Las bases existen, hay que estructurar. Tiene la ventaja de no partir de cero." },
      { name: 'Aceleraci\u00f3n', desc: "Tiene buenas bases. Es momento de escalar e industrializar sus iniciativas." },
      { name: 'Excelencia', desc: "Su madurez IA es avanzada. Conc\u00e9ntrese en la optimizaci\u00f3n y la innovaci\u00f3n continua." }
    ]
  };

  let levelIdx, bg, color;
  if (score < 42) { levelIdx = 0; bg = 'rgba(232, 93, 58, 0.15)'; color = '#E85D3A'; }
  else if (score < 62) { levelIdx = 1; bg = 'rgba(242, 153, 58, 0.15)'; color = '#F2993A'; }
  else if (score < 82) { levelIdx = 2; bg = 'rgba(58, 143, 242, 0.15)'; color = '#3A8FF2'; }
  else { levelIdx = 3; bg = 'rgba(76, 175, 80, 0.15)'; color = '#4CAF50'; }

  const lvl = (levels[lang] || levels.fr)[levelIdx];
  levelEl.style.background = bg;
  levelEl.style.color = color;
  levelEl.innerHTML = `<span style="font-size:1.1rem">&#9679;</span> ${lvl.name}`;
  descEl.textContent = lvl.desc;
}

function renderRadar(scores) {
  const svg = document.getElementById('radarChart');
  svg.innerHTML = '';

  const cx = 160, cy = 160, maxR = 120;
  const n = 5;
  const angleStep = (2 * Math.PI) / n;
  const startAngle = -Math.PI / 2;

  function getPoint(index, radius) {
    const angle = startAngle + index * angleStep;
    return {
      x: cx + radius * Math.cos(angle),
      y: cy + radius * Math.sin(angle)
    };
  }

  // Grid levels
  [0.33, 0.66, 1].forEach(level => {
    const points = [];
    for (let i = 0; i < n; i++) {
      const p = getPoint(i, maxR * level);
      points.push(`${p.x},${p.y}`);
    }
    const poly = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
    poly.setAttribute('points', points.join(' '));
    poly.setAttribute('fill', 'none');
    poly.setAttribute('stroke', 'rgba(255,255,255,0.06)');
    poly.setAttribute('stroke-width', '1');
    svg.appendChild(poly);
  });

  // Axes
  for (let i = 0; i < n; i++) {
    const p = getPoint(i, maxR);
    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    line.setAttribute('x1', cx);
    line.setAttribute('y1', cy);
    line.setAttribute('x2', p.x);
    line.setAttribute('y2', p.y);
    line.setAttribute('stroke', 'rgba(255,255,255,0.04)');
    line.setAttribute('stroke-width', '1');
    svg.appendChild(line);
  }

  // Data polygon
  const dataPoints = [];
  for (let i = 0; i < n; i++) {
    const pct = scores[i] / 20;
    const p = getPoint(i, maxR * pct);
    dataPoints.push(`${p.x},${p.y}`);
  }

  const fillPoly = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
  fillPoly.setAttribute('points', dataPoints.join(' '));
  fillPoly.setAttribute('fill', 'rgba(242, 107, 58, 0.15)');
  fillPoly.setAttribute('stroke', '#F26B3A');
  fillPoly.setAttribute('stroke-width', '2');
  svg.appendChild(fillPoly);

  // Data dots
  for (let i = 0; i < n; i++) {
    const pct = scores[i] / 20;
    const p = getPoint(i, maxR * pct);
    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    circle.setAttribute('cx', p.x);
    circle.setAttribute('cy', p.y);
    circle.setAttribute('r', '5');
    circle.setAttribute('fill', '#F26B3A');
    circle.setAttribute('stroke', '#0A0A0F');
    circle.setAttribute('stroke-width', '2');
    svg.appendChild(circle);
  }

  // Axis labels
  const labelOffsets = [
    { dx: 0, dy: -14, anchor: 'middle' },
    { dx: 14, dy: 4, anchor: 'start' },
    { dx: 10, dy: 14, anchor: 'start' },
    { dx: -10, dy: 14, anchor: 'end' },
    { dx: -14, dy: 4, anchor: 'end' }
  ];

  const shortLabelsI18N = {
    fr: ['Culture', 'Usages', 'Data', 'Comp\u00e9tences', 'Strat\u00e9gie'],
    en: ['Culture', 'Usage', 'Data', 'Skills', 'Strategy'],
    es: ['Cultura', 'Usos', 'Datos', 'Competencias', 'Estrategia']
  };
  const lang = window.diagLang ? window.diagLang() : 'fr';
  const shortLabels = shortLabelsI18N[lang] || shortLabelsI18N.fr;

  for (let i = 0; i < n; i++) {
    const p = getPoint(i, maxR + 28);
    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    text.setAttribute('x', p.x + labelOffsets[i].dx);
    text.setAttribute('y', p.y + labelOffsets[i].dy);
    text.setAttribute('text-anchor', labelOffsets[i].anchor);
    text.setAttribute('fill', '#8A8A95');
    text.setAttribute('font-size', '11');
    text.setAttribute('font-family', 'DM Sans, sans-serif');
    text.textContent = shortLabels[i];
    svg.appendChild(text);
  }

  // Legend below chart
  const pillarNames = (PILLARS_I18N[lang] || PILLARS_I18N.fr);
  const labelsEl = document.getElementById('radarLabels');
  labelsEl.innerHTML = pillarNames.map((p, i) =>
    `<span class="radar-label-item"><span class="radar-label-dot"></span>${p} : ${scores[i]}/20</span>`
  ).join('');
}

function renderPillarBars(scores) {
  const lang = window.diagLang ? window.diagLang() : 'fr';
  const pillarNames = (PILLARS_I18N[lang] || PILLARS_I18N.fr);
  const container = document.getElementById('pillarBarsContainer');
  container.innerHTML = '';

  pillarNames.forEach((name, i) => {
    const pct = (scores[i] / 20) * 100;
    let color;
    if (scores[i] <= 7) color = '#E85D3A';
    else if (scores[i] <= 12) color = '#F2993A';
    else if (scores[i] <= 17) color = '#3A8FF2';
    else color = '#4CAF50';

    const item = document.createElement('div');
    item.className = 'pillar-bar-item';
    item.innerHTML = `
      <div class="pillar-bar-header">
        <span class="pillar-bar-name">${name}</span>
        <span class="pillar-bar-score" style="color:${color}">${scores[i]} / 20</span>
      </div>
      <div class="pillar-bar-track">
        <div class="pillar-bar-fill" style="background:${color}" data-width="${pct}"></div>
      </div>
    `;
    container.appendChild(item);
  });

  setTimeout(() => {
    document.querySelectorAll('.pillar-bar-fill').forEach(bar => {
      bar.style.width = bar.dataset.width + '%';
    });
  }, 300);
}

function renderRecommendations(scores) {
  const lang = window.diagLang ? window.diagLang() : 'fr';
  const container = document.getElementById('recoCards');
  container.innerHTML = '';

  // 3 weakest pillars
  const indexed = scores.map((s, i) => ({ score: s, index: i }));
  indexed.sort((a, b) => a.score - b.score);
  const top3 = indexed.slice(0, 3);

  const pillarNamesLocal = (PILLARS_I18N[lang] || PILLARS_I18N.fr);
  const actionLabel = lang === 'es' ? 'Acci\u00f3n recomendada' : lang === 'en' ? 'Recommended action' : 'Action recommand\u00e9e';
  const discoverLabel = lang === 'es' ? 'Descubrir' : lang === 'en' ? 'Discover' : 'D\u00e9couvrir';

  top3.forEach((item, rank) => {
    const reco = RECOMMENDATIONS[item.index];
    const recoTrans = RECO_TEXT[lang] ? RECO_TEXT[lang][item.index] : null;
    const pillar = pillarNamesLocal[item.index];
    const scoreColor = item.score <= 7 ? '#E85D3A' : item.score <= 12 ? '#F2993A' : '#3A8FF2';

    const card = document.createElement('div');
    card.className = 'reco-card animate-in animate-delay-' + (rank + 1);
    card.innerHTML = `
      <div style="position:absolute;top:0;left:0;width:4px;height:100%;background:${scoreColor};border-radius:4px 0 0 4px;"></div>
      <div class="reco-card-header">
        <span class="reco-card-pillar" style="color:${scoreColor}">${pillar}</span>
        <span class="reco-card-score" style="background:${scoreColor}20;color:${scoreColor}">${item.score} / 20</span>
      </div>
      <p class="reco-card-insight">${recoTrans ? recoTrans.insight : reco.insight}</p>
      <div class="reco-card-action">
        <div class="reco-card-action-label">${actionLabel}</div>
        <div class="reco-card-action-text">${recoTrans ? recoTrans.action : reco.action}</div>
      </div>
      <a href="${reco.link}" target="_blank" class="reco-card-link">
        ${discoverLabel} : ${recoTrans ? recoTrans.offer : reco.offer} <span>&rarr;</span>
      </a>
    `;
    container.appendChild(card);
  });
}

// (Lead capture is now handled by the gate section before results)

// ============================================================
// KEYBOARD NAVIGATION
// ============================================================
document.addEventListener('keydown', (e) => {
  const qSection = document.getElementById('sectionQuestions');
  if (!qSection.classList.contains('active')) return;

  if (e.key >= '1' && e.key <= '4') {
    const idx = parseInt(e.key) - 1;
    const cards = document.querySelectorAll('.answer-card');
    if (cards[idx]) cards[idx].click();
  }

  if (e.key === 'ArrowRight' || e.key === 'Enter') {
    if (answers[currentQuestion] !== null) nextQuestion();
  }

  if (e.key === 'ArrowLeft') {
    prevQuestion();
  }
});

// ============================================================
// RESTART DIAGNOSTIC
// ============================================================
function restartDiagnostic() {
  // Clear state
  localStorage.removeItem('homosapia_diag');
  localStorage.removeItem('homosapia_diag_contact');
  answers = new Array(15).fill(null);
  currentQuestion = 0;
  companyProfile = { name: '', role: '', sector: '', size: '', website: '' };
  leadContact = { firstname: '', lastname: '', email: '', phone: '' };

  // Reset profile form fields
  var cn = document.getElementById('companyName'); if (cn) cn.value = '';
  var cw = document.getElementById('companyWebsite'); if (cw) cw.value = '';
  var rl = document.getElementById('role'); if (rl) rl.selectedIndex = 0;
  var sc2 = document.getElementById('sector'); if (sc2) sc2.selectedIndex = 0;
  var sz = document.getElementById('size'); if (sz) sz.selectedIndex = 0;

  // Reset gate form fields
  var gf = document.getElementById('gateFirstname'); if (gf) gf.value = '';
  var gl = document.getElementById('gateLastname'); if (gl) gl.value = '';
  var ge = document.getElementById('gateEmail'); if (ge) ge.value = '';
  var gp = document.getElementById('gatePhone'); if (gp) gp.value = '';

  // Reset results display
  var rs = document.getElementById('reportSent');
  if (rs) rs.style.display = 'none';

  // Clear rendered results (score circle, radar, bars, recommendations)
  var sc = document.getElementById('scoreCircle');
  if (sc) sc.innerHTML = '';
  var rc = document.getElementById('radarChart');
  if (rc) rc.innerHTML = '';
  var pb2 = document.getElementById('pillarBars');
  if (pb2) pb2.innerHTML = '';
  var reco = document.getElementById('recommendations');
  if (reco) reco.innerHTML = '';

  // Reset progress bar
  var pb = document.getElementById('progressInline');
  if (pb) pb.classList.remove('visible');

  // Navigate to landing
  showSection('sectionLanding');
  setTimeout(function() {
    document.getElementById('sectionLanding').classList.add('visible');
  }, 50);
}

// ============================================================
// RESUME / RESTART FROM MODAL
// ============================================================
function resumeDiagnostic() {
  document.getElementById('resumeModal').style.display = 'none';
  const answered = answers.filter(a => a !== null).length;
  if (answered >= 15) {
    // All answered — go to gate or results
    document.getElementById('progressInline').classList.remove('visible');

    showSection('sectionResults');
    setTimeout(() => {
      const ps = [0,0,0,0,0];
      QUESTIONS.forEach((q,i) => { if(answers[i]!==null) ps[q.pillar]+=q.answers[answers[i]].score; });
      const t = ps.reduce((a,b)=>a+b,0);
      renderScoreCircle(t); renderLevel(t); renderRadar(ps); renderPillarBars(ps); renderRecommendations(ps);
      if(companyProfile.name) document.getElementById('resultsCompany').textContent = companyProfile.name;
    }, 100);
  } else {
    // Partial — resume at current question
    currentQuestion = answered;
    document.getElementById('progressInline').classList.add('visible');
    showSection('sectionQuestions');
    renderQuestion();
  }
}

function restartFromModal() {
  document.getElementById('resumeModal').style.display = 'none';
  restartDiagnostic();
}

// ============================================================
// INIT
// ============================================================
loadState();

if (answers.some(a => a !== null)) {
  if (answers.every(a => a !== null)) {
    // All answered — show results directly
    document.getElementById('progressInline').classList.remove('visible');

    showSection('sectionResults');
    setTimeout(() => {
      const ps = [0,0,0,0,0];
      QUESTIONS.forEach((q,i) => { if(answers[i]!==null) ps[q.pillar]+=q.answers[answers[i]].score; });
      const t = ps.reduce((a,b)=>a+b,0);
      renderScoreCircle(t); renderLevel(t); renderRadar(ps); renderPillarBars(ps); renderRecommendations(ps);
      if(companyProfile.name) document.getElementById('resultsCompany').textContent = companyProfile.name;
    }, 100);
  } else {
    // Partial progress — show resume modal
    const answered = answers.filter(a => a !== null).length;
    const modal = document.getElementById('resumeModal');
    document.getElementById('resumeProgress').textContent = answered + ' / 15 questions complétées';
    modal.style.display = 'flex';
  }
}

// Trigger landing animation
setTimeout(() => {
  const landing = document.getElementById('sectionLanding');
  if (landing.classList.contains('active')) {
    landing.classList.add('visible');
  }
}, 50);
</script>

</body>
</html>
